# Keyboard Shortcuts Progress

## Goal

Implement keyboard shortcuts for the log viewer:
- j/k to navigate logs
- Enter to open detail modal
- Esc to close
- / to focus search
- l to toggle live mode

Power users will love this. Minimal code, high UX impact.

## Goal Context

Interview responses from goal clarification:
- Problem: Power user efficiency - mouse-free navigation for faster log browsing
- Constraints: Must be discoverable AND must not conflict with browser/system shortcuts
- Success criteria: Tests pass and code works - basic functionality verified

## Status

- [x] Research phase
- [x] Requirements phase
- [x] Design phase
- [x] Tasks phase
- [ ] Implementation

## Completed Tasks

- [x] 1.1 Create keyboard utilities module - 5e94cfc
- [x] 1.2 Add selectedIndex state and j/k navigation to page - 9e3719b
- [x] 1.3 Add selectedIndex prop to LogTable and pass to children - 16d8c8a
- [x] 1.4 Add visual selection highlight to LogRow - f874ede
- [x] 1.5 Add visual selection highlight to LogCard - bc4b4c7
- [x] V1 [VERIFY] Quality checkpoint - fixed a11y warnings, passed lint/check
- [x] 1.6 Add Enter to open modal for selected log - 300b119
- [x] 1.7 Verify Escape closes modal - verified (no code changes needed)
- [x] 1.8 Add / to focus search and Escape to blur - 985c60c
- [x] 1.9 Add l to toggle live mode - 58c4827
- [x] V2 Quality checkpoint - passed (no fixes needed)
- [x] 1.10 Create KeyboardHelpModal component - 102c61d
- [x] 1.11 Add ? shortcut to open help modal - 7a7cd75
- [x] 1.12 POC Checkpoint - End-to-end verification - bb6555c
- [x] 2.1 Add selection reset on filter changes - 286f937
- [x] 2.2 Add screen reader announcements for navigation - 6369ac2
- [x] 2.3 Code review and cleanup - ae25858
- [x] V3 Quality checkpoint - passed (no fixes needed)
- [x] 3.1 Unit tests for keyboard utilities - 54f0721
- [x] 3.2 Component tests for LogRow isSelected - df359a1
- [x] 3.3 Component tests for LogCard isSelected - c78b120

## Current Task

Awaiting next task

## Next

Task 3.4: Component tests for SearchInput ref and onEscape

## Learnings

- Codebase uses `<svelte:document onkeydown={handler}>` for global shortcuts (modals). This is the recommended Svelte 5 pattern.
- LogTable renders both `LogRow` (desktop) and `LogCard` (mobile) - navigation must work on both.
- Page already has `selectedLog` and `showDetailModal` state - just need to add `selectedIndex` for keyboard navigation.
- SearchInput uses shadcn-svelte Input with `ref` bindable - can be focused programmatically.
- LiveToggle uses `bind:enabled` - toggling is a single state assignment.
- Existing `announceToScreenReader` utility in focus-trap.ts can be reused for accessibility.
- j/k/l are safe single-key shortcuts - no browser conflicts since browsers use modifier keys.
- Must guard against form field focus - check event.target.tagName for INPUT/TEXTAREA/SELECT.
- Quality commands: lint (`bun run lint`), check (`bun run check`), test:unit, test:component, test:e2e, build.
- SearchInput currently does NOT expose a ref - will need modification to add `ref` bindable prop for `/` shortcut.
- LiveToggle has `disabled` prop that blocks toggle when live is paused due to search - `l` shortcut must respect this.
- Selection must reset on filter change because `allLogs` array changes content - index would point to different/wrong log.
- Gmail-style boundary behavior (stop, not wrap) is the expected pattern for power users.
- Help modal (`?` shortcut) follows GitHub/Gmail pattern for discoverability - critical for new users.
- `selectedIndex` should be -1 for "no selection" state, not null, for simpler boundary checks.
- LogTable has internal `sortedLogs` derived array - selectedIndex must track position in sorted array, passed to LogTable which maps it to the correct row.
- LogRow and LogCard have identical interface structure - adding `isSelected` prop to both for consistency.
- LogDetailModal already handles Escape via its own `<svelte:document>` handler - page-level handler must check modal state to avoid conflicts.
- event.isComposing check is critical for international keyboard users with IME (Japanese, Chinese, Korean input).
- Single keyboard handler at page level is cleaner than distributed handlers - matches modal pattern and avoids prop drilling.
- scrollIntoView({ block: 'nearest' }) prevents unnecessary scrolling when selected item is already visible.
- Task planning: 22 total tasks across 4 phases (POC: 12, Refactoring: 3, Testing: 5, Quality Gates: 3).
- Quality checkpoints inserted every 2-3 tasks to catch type/lint issues early.
- `aria-selected` is only valid for roles like option/row/tab, not `button`. Use `aria-current="true"` for selected state on button-like elements.
- POC phase focuses on getting all shortcuts working before adding tests - validates idea fast.
- SearchInput modification is critical path - must expose ref before / shortcut can work.
- KeyboardHelpModal follows exact same pattern as LogDetailModal for consistency.
- Filter reset logic must be added to all 4 filter handlers (search, level, time range, clear).
- Component tests needed for LogRow, LogCard, SearchInput, and KeyboardHelpModal - all have new props/behavior.
- LogDetailModal already handles Escape via `<svelte:document onkeydown>` with focus restoration logic using `previouslyFocusedElement`.
- `closeDetailModal()` clears modal state but preserves `selectedIndex` - selection survives modal close automatically.
- POC Phase 1 complete: All shortcuts (j/k/Enter/Escape///l/?) implemented and verified via type check + lint + build. Ready for manual testing.
- Screen reader announcements use `announceToScreenReader` utility from focus-trap.ts - track prevIndex to announce only on actual selection change.
- Code cleanup: Remove unused exports (knip catches these), add loading state guards to navigation shortcuts, keep internal types non-exported.
- Unit tests naming convention: files must end with `.unit.test.ts` (not `.test.ts`) for vitest unit project to detect them.
- Unit tests run in Node.js environment without DOM - mock HTMLElement with plain objects containing `tagName` property instead of using `document.createElement`.
